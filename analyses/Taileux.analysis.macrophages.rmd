---
title: "Data analysis markdown document for Taileux et al. (Macrophages)."
author: '9401'
date: "04/06/2020"
output: html_document
---

Load packages
```{r}
rm(list=ls(all=TRUE))
library(magrittr)
library(dplyr)
```

Load data file
```{r}
data.file <- "Taileux.datasets/02_tailleux_18hrs_a.Rmd.tt.MP.2020_05_22.txt"
stopifnot(file.exists(data.file))
df <- read.table(data.file, header = T, sep = "\t", quote = "", stringsAsFactors = F)
# df <- read.delim(file = data.file, stringsAsFactors = F )
dim(df) # 24501     9   
head(df)
```

Getting to know the summary of the variables
```{r}
sapply(df, class) %>% as.data.frame
```

Checking if all probes have a proper gene symbol
```{r}

# Are there any instances of a single space instead of a gene symbol?
any(df$SYMBOL == " ")# NA,therefore, possibility of NA values for absent gene symbols

# Are there any instances of one or more spaces used instead of a gene symbol?
any(grepl(pattern = " +", df$SYMBOL)) # FALSE 

#Are there any instances of an EMPTY STRINGS instead of a gene symbol?
any(df$SYMBOL == "") # NA, therefore,possibility of NA values for absent gene symbols 

any(is.na(df$SYMBOL)) # TRUE, verifying that some gene symbols are missing.
sum(is.na(df$SYMBOL)) #  1205
# Looking at some of the probes with missing gene symbols
df %>%
  filter(is.na(df$SYMBOL)) %>%
  head %>%
  print(., row.names = F)
```

Removing the probes that do not have a proper gene symbols
```{r}
df2 <- filter(df, !is.na(df$SYMBOL))
nrow(df) # 24501
nrow(df2) # 23296

# proportion of those with missing symbols
pc <- sum(is.na(df$SYMBOL))/ length(df$SYMBOL) * 100
pc <- round(pc, digits = 1)
paste0(pc, "%") # "4.9 %"

```

Are any genes that are duplicated?
```{r}
any(duplicated(df2$SYMBOL))  # TRUE
symb.uniq <- unique(df2$SYMBOL ) 
# Number of unique gene symbols
length(symb.uniq) # 13768 
# Number of duplicated gene symbols
sum(duplicated(df2$SYMBOL)) # 9528

```
```{r}
df3 <- subset(df2) %>% 
  dplyr::select(SYMBOL, adj.P.Val, P.Value, logFC)
nrow(df3) #23296
```

 Up-regulated probes 
```{r}
probes.up <- df3 %>%
  filter(adj.P.Val <= 0.01) %>%
  filter(logFC >= 1) 
nrow(probes.up) # 732
```

Up-regulated probes associated with unique gene symbols
```{r}

genes.up <- df3 %>%
  filter(adj.P.Val <= 0.01) %>%
  filter(logFC >= 1) %>%
  distinct(SYMBOL)
  nrow(genes.up) # 515
  
  any(duplicated(genes.up)) #FALSE
  
  genes.up.uniq <- sort(genes.up$SYMBOL)
  head(genes.up.uniq)
  write(genes.up.uniq, file = "genes.up.uniq.Taileux.macrophages")
```

Down-regulated probes 
```{r}
probes.down <- df3 %>%
  filter(adj.P.Val <= 0.01) %>%
  filter(logFC <= -1) 
nrow(probes.down) # 997
```

Down-regulated probes associated with unique gene symbols
```{r}

genes.down <- df3 %>%
  filter(adj.P.Val <= 0.01) %>%
  filter(logFC <= -1) %>%
  distinct(SYMBOL)
  nrow(genes.down) #  802
  
  any(duplicated(genes.down)) # FALSE
  genes.down.uniq <- sort(genes.down$SYMBOL)
  head(genes.down.uniq)
  write(genes.down.uniq, file = "genes.down.uniq.Taileux.macrophages")
  
```

Regulated genes as a function of parameters
```{r}
# Create empty matrices
p.value.cutoffs <- c(0.001, 0.005, 0.01, 0.05)
fc.cutoffs.up <- c(0.5, 1, 1.5, 2)
parameter.table.up <- matrix(rep(NA, (length(p.value.cutoffs) * length(fc.cutoffs.up))),
                                 ncol = length(fc.cutoffs.up),
                                 dimnames = list(
                                as.character(p.value.cutoffs),
                                as.character(fc.cutoffs.up)),
                                )
parameter.table.up 

fc.cutoffs.down <- fc.cutoffs.up*-1
fc.cutoffs.down
parameter.table.down <- parameter.table.up %>%
  set_colnames(fc.cutoffs.down)

parameter.table.down
```

Up-regulated genes as a function of parameters
```{r}
for (i in seq_along(fc.cutoffs.up)) {
  for (j in seq_along(p.value.cutoffs)) {
    parameter.table.up[i,j] <- df3 %>%
      filter(adj.P.Val <= p.value.cutoffs[i]) %>%
      filter(logFC >= fc.cutoffs.up[j]) %>%
      distinct(SYMBOL) %>%
      nrow
  }
}
parameter.table.up
write(parameter.table.up, file ="parameter.table.up.Taileux.macrophages")
```
Down-regulated genes a function of parameters
```{r}
for (i in seq_along(fc.cutoffs.down)) {
  for (j in seq_along(p.value.cutoffs)) {
    parameter.table.down[i,j] <- df3 %>%
      filter(adj.P.Val <= p.value.cutoffs[i]) %>%
      filter(logFC <= fc.cutoffs.down[j]) %>%
       distinct(SYMBOL) %>%
      nrow
  }
  
}
parameter.table.down
write(parameter.table.down, file = "parameter.table.down.Taileux.macrophages")

```




